<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>撰寫 Python 程式來解數獨了 &mdash; SudokuStudyLib 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="SudokuStudyLib 1.0 documentation" href="index.html" />
    <link rel="next" title="程式詳解: sudoku套件" href="sudoku.html" />
    <link rel="prev" title="如何在 Python 中製作一個解數獨的模擬環境?" href="data.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>瀏覽</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="總索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >模組</a> |</li>
        <li class="right" >
          <a href="sudoku.html" title="程式詳解: sudoku套件"
             accesskey="N">下一頁</a> |</li>
        <li class="right" >
          <a href="data.html" title="如何在 Python 中製作一個解數獨的模擬環境?"
             accesskey="P">上一頁</a> |</li>
        <li><a href="index.html">SudokuStudyLib 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">內容目錄</a></h3>
  <ul>
<li><a class="reference internal" href="#">撰寫 Python 程式來解數獨了</a><ul>
<li><a class="reference internal" href="#solving-environment">求解環境</a></li>
<li><a class="reference internal" href="#solving-process">求解過程</a></li>
<li><a class="reference internal" href="#some-basic-methods">一些基本求解方法</a></li>
<li><a class="reference internal" href="#how-to-implement-a-method">如何去實作一個求解方法呢？</a></li>
</ul>
</li>
</ul>

  <h4>上一個主題</h4>
  <p class="topless"><a href="data.html"
                        title="上一章">如何在 Python 中製作一個解數獨的模擬環境?</a></p>
  <h4>下一個主題</h4>
  <p class="topless"><a href="sudoku.html"
                        title="下一章">程式詳解: sudoku套件</a></p>
  <h3>本頁</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/program.txt"
           rel="nofollow">顯示原始碼</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>快速搜尋</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="start-programming-to-solve-a-sudoku">
<h1>撰寫 Python 程式來解數獨了<a class="headerlink" href="#start-programming-to-solve-a-sudoku" title="Permalink to this headline">¶</a></h1>
<p>當我們已經在電腦建構好一個數獨模擬世界時，對那些我們以前使用手寫的方式所發現的解數獨方法，我們就可以著手來將其以電腦語言(這裡是 Python)來重新闡述。就術語來說，稱為程式設計(Programming)。所以程式設計可以視為我們在教導電腦如何去執行我們解決問題的方法。</p>
<p>一開始，我們先介紹這個專案整個求解數獨的環境，然後我們再說明一些基本方法。</p>
<div class="section" id="solving-environment">
<h2>求解環境<a class="headerlink" href="#solving-environment" title="Permalink to this headline">¶</a></h2>
<p>我們設計了 solve() 這個函數來做整個求解數獨的入口，另外也定義了兩個事件類別，SudokuDon 及 SudokuError，以處理求解過程中發現已經解開數獨或者產生違反數獨規則的狀況。</p>
<div class="admonition note">
<p class="first admonition-title">註解</p>
<p>甚麼是「<strong>例外處理(Exception)</strong>」？</p>
<p>「例外處理(Exceptions)」是一種事件定義，當構成這個事件的條件滿足時，系統就會停止處理目前的事務，而跳到該事件的處理程序。在這個專案中有兩個主要的例外處理：</p>
<dl class="last docutils">
<dt>SudokuDone:</dt>
<dd><p class="first last">當這個數獨已經被解開時，這個例外處理會被叫醒</p>
</dd>
<dt>SudokuError:</dt>
<dd><p class="first last">當求解過程中發現違反數獨規則時，這個例外處理會被叫醒</p>
</dd>
</dl>
</div>
<p>為了讓整個求解環境能夠知道有多少種求解方法它能夠使用，我們設計了一個類別，SolveMethod。我們以這個類別來將所有的求解方法置入成一個**虛擬大腦**。我們可以將這個虛擬大腦視為是這個美麗山谷的守護神。每當有新進來此山谷者，找不到居住所時，都可以透過祂來選擇出適合的房子，但祂也可能回答：「對不起，我也不知道該如何選擇！」</p>
<p>對**虛擬大腦**而言，每一個解數獨的方法都化為一個 SovleMethod 物件儲存在裡面，這些物件有以下主要屬性：</p>
<blockquote>
<div><ol class="arabic simple">
<li><p class="first">fun: 解數獨方法的 Python 函數名稱</p>
</li>
<li><p class="first">idx: 方法的排序，從簡單的方法開始到困難的方法依序排列，虛擬大腦將依序一個一個地使用這些方法來解開數獨。</p>
</li>
<li><p class="first">name: 此方法的名稱，使用者可以自訂其名稱</p>
</li>
<li><p class="first">level: 困難度，對人的直覺而言。系統用此來計數解開整個數獨的困難積分。</p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="solving-process">
<h2>求解過程<a class="headerlink" href="#solving-process" title="Permalink to this headline">¶</a></h2>
<p>下面是主要求解函數，solve()，的流程圖：</p>
<img alt="_images/flowchart.png" src="_images/flowchart.png" />
<div class="admonition note">
<p class="first admonition-title">註解</p>
<p><strong>「有用(work)」或「沒用(not work)」？</strong></p>
<p>一個求解方法如果是「有用」，表示它能夠：</p>
<ol class="last arabic simple">
<li><p class="first">讓一個或多個人找到他們的居所</p>
</li>
<li><p class="first">或者是可讓一間或多間房子知道一個或多個國家的人不能居住在他們的房子</p>
</li>
</ol>
</div>
<p>在這張流程圖中，我們知道：</p>
<ol class="arabic simple">
<li><p class="first">當一個求解方法有用時，設定了一個人的住所或降低了一間房子可居住者的可能性時，整個虛擬大腦會重新回到第一個求解方法來繼續求解。</p>
</li>
<li><p class="first">假如一個求解方法沒用時，它會交給下一個方法來解決。</p>
</li>
<li><p class="first">當到最後一個方法都沒用時，他會離開整個求解環境並說：「我無法解開這個遊戲，抱歉！」</p>
</li>
<li><p class="first">在整個求解過程中，如果發現已解開數獨(Done)或者違反了數獨規則(Error)時，它就會跳離整個求解環境。</p>
</li>
</ol>
</div>
<div class="section" id="some-basic-methods">
<h2>一些基本求解方法<a class="headerlink" href="#some-basic-methods" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">fill_only_one_possible:</p>
<p>在每一個房子群組中，檢查每一間房子，是否只有一間房子能夠讓某國的人民居住，如果是，則該間房子必然要讓那國的人民遷入。</p>
</li>
<li><p class="first">fill_last_position_of_group:</p>
<p>當一個房子群組中只剩一間空房時，那必然是只有一個國家的人民尚未入住。</p>
</li>
<li><p class="first">check_obvious_number:</p>
<p>檢查每一個國家中已經定居的國民，看他們所在的位置所交互影響、而尚未有該國人民入住的區塊中，是否可以找到僅剩一間房子容許該國國民來定居，如果是，則可以很明顯地配給該房子給與該國的人民。</p>
</li>
<li><p class="first">check_inobvious_number:</p>
<p>這個求解方法與 check_obvious_number 相同，只是先找到一些區塊的虛擬國民，讓他們以及已定居的國民一起來探測其他尚未有本國國民居住的區塊。</p>
</li>
</ol>
<div class="sidebar" id="chain">
<p class="first sidebar-title">甚麼是「<strong>鏈結(Chain)</strong>」？</p>
<p class="last">「鏈結(Chain)」是由同一個房子群體中兩個或以上的空房子所組成。形成的要件就是這在這些房子中所有可能能夠居住在這些房子裡面的國家總數與這些房子的總數相等。如此我們就可以說這些房子形成了一個鏈結。這些國家的人都只能居住在這些房子上，而在同一房子群體的其他空房子則不再可能居住這些國家的人民。</p>
</div>
<ol class="arabic" start="5">
<li><p class="first">reduce_by_group_number:</p>
<p>如果在一個房子區塊中形成了一個虛擬國民時， 那與這個虛擬國民同方向的房子群組中的其他空房子，就不可能居住這個國民。</p>
</li>
<li><p class="first">update_chain:</p>
<p>當一些房子開始住人以後，會影響一些房子不再能夠允許一些國家的居民，而這些空房子可能因此在一個房子群組中(x軸、y軸、區塊)中產生了一個**鍵鏈(Chain)**。這個方法就是去尋找可能的鍵鏈，並將鍵鏈所影響的空房子減少它們被這些鍵鏈的國民居住的可能。</p>
</li>
</ol>
</div>
<div class="section" id="how-to-implement-a-method">
<h2>如何去實作一個求解方法呢？<a class="headerlink" href="#how-to-implement-a-method" title="Permalink to this headline">¶</a></h2>
<p>我們來實作一個只為一個國家的人民來看是否能有一個直覺的方法來為一個尚未有該國住民的區塊找到住所，我們命為 check_obvious_for_a_country(m, num)：</p>
<pre class="code literal-block">
<span class="ln"> 1 </span> def check_obvious_for_a country(m, num):
<span class="ln"> 2 </span> checked = list()
<span class="ln"> 3 </span> for p1 in m.n[num].p:
<span class="ln"> 4 </span>     for b in m.b[p1.b].effects:
<span class="ln"> 5 </span>         possible = []
<span class="ln"> 6 </span>         if b in checked:
<span class="ln"> 7 </span>             continue
<span class="ln"> 8 </span>         else:
<span class="ln"> 9 </span>             checked.add(b)
<span class="ln">10 </span>         if num not in m.b[b].possible:
<span class="ln">11 </span>             continue
<span class="ln">12 </span>         for p2 in m.b[b].p:
<span class="ln">13 </span>             if p2.v != 0 or p2.can_see(p1) &gt; 0:
<span class="ln">14 </span>                 continue;
<span class="ln">15 </span>             if not m.lineX[p2.x].allow(num):
<span class="ln">16 </span>                 continue
<span class="ln">17 </span>             if not m.lineY[p2.y].allow(num):
<span class="ln">18 </span>                 continue
<span class="ln">19 </span>             possible.append(p2)
<span class="ln">20 </span>         if len(possible) == 1:
<span class="ln">21 </span>             m.setit(possible[0].x, possible[0].y, num, d=&quot;Obvious For a Country People&quot;)
</pre>
<ol class="arabic simple">
<li><p class="first">line#1, 定義一個求解方法, <em>m</em> 是這個遊戲的數獨世界，<strong>num</strong> 則是一個國家代碼, 可能值為1-9。</p>
</li>
<li><p class="first">line#3, 將每一個已經入住此山谷的此國國民都找出他們的住所。</p>
</li>
<li><p class="first">line#4-9, 檢查每一個尚未被檢查的房子區塊。</p>
</li>
<li><p class="first">line#10-11, 如果此區塊已有該國人民居住，那就不用檢查了。</p>
</li>
<li><p class="first">line#12-19, 檢查此區塊每一個空房是否可以讓該國的人民來居住。如果是，則將該房子放進去可能的名單裡面。</p>
</li>
<li><p class="first">line#20-21, 最後檢查可能的名單中，如果只有一個時，那就表示該房子必然由該國人民來居住。</p>
</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>瀏覽</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="總索引"
             >索引</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >模組</a> |</li>
        <li class="right" >
          <a href="sudoku.html" title="程式詳解: sudoku套件"
             >下一頁</a> |</li>
        <li class="right" >
          <a href="data.html" title="如何在 Python 中製作一個解數獨的模擬環境?"
             >上一頁</a> |</li>
        <li><a href="index.html">SudokuStudyLib 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Robert J. Hwang.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>